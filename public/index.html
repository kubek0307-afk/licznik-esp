<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Licznik</title>
<style>
body { margin:0; background:#111; color:#eee; font-family:Arial }
.box { background:#1d1d1d; padding:12px; border-radius:8px; margin:12px }
button { width:100%; padding:14px; margin-top:10px; font-size:16px;
  background:#4f8cff; border:none; color:#fff; border-radius:6px }
input, textarea, select {
  width:100%; padding:10px; margin-top:6px;
  border:none; border-radius:6px; background:#222; color:#fff
}
.record { border-bottom:1px solid #333; padding:8px 0 }
img { max-width:100%; border-radius:6px; margin-top:6px }
</style>
</head>
<body>

<div class="box" id="loginBox">
  <input id="codeInput" type="password" placeholder="Kod dostępu">
  <button onclick="login()">Zaloguj</button>
</div>

<div id="app" style="display:none">

  <div class="box">
    Lysy: <b id="cLysy">0</b><br>
    Paweł: <b id="cPawel">0</b>
  </div>

  <div class="box">
    <select id="person">
      <option value="lysy">Lysy</option>
      <option value="pawel">Paweł</option>
    </select>

    <textarea id="text" placeholder="Opis"></textarea>
    <input type="file" id="img">

    <button onclick="send()">Dodaj</button>
  </div>

  <div class="box">
    <h3>Historia</h3>
    <div id="history"></div>
  </div>

</div>

<script>
let accessCode = localStorage.getItem("accessCode") || "";

function login(){
  accessCode = document.getElementById("codeInput").value;
  localStorage.setItem("accessCode", accessCode);
  loadData();
}

function showApp(){
  document.getElementById("loginBox").style.display = "none";
  document.getElementById("app").style.display = "block";
}

async function loadData(){
  const res = await fetch("/api/data", {
    headers: { "access-code": accessCode }
  });

  if (!res.ok) {
    alert("Zły kod");
    return;
  }

  const data = await res.json();
  showApp();

  document.getElementById("cLysy").innerText  = data.lysy;
  document.getElementById("cPawel").innerText = data.pawel;

  let html = "";
  for (const h of data.history) {
    html += `
      <div class="record">
        <b>${h.person}</b> | ${h.date}<br>
        ${h.text || ""}
        ${h.img ? `<br><img src="${h.img}">` : ""}
      </div>
    `;
  }

  document.getElementById("history").innerHTML = html;
}

async function send(){
  const fd = new FormData();
  fd.append("person", document.getElementById("person").value);
  fd.append("text", document.getElementById("text").value);

  const img = document.getElementById("img");
  if (img.files[0]) fd.append("image", img.files[0]);

  await fetch("/api/add", {
    method: "POST",
    headers: { "access-code": accessCode },
    body: fd
  });

  document.getElementById("text").value = "";
  document.getElementById("img").value = "";

  loadData();
}

if (accessCode) loadData();
</script>

</body>
</html>
