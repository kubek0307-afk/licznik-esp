<script>
let accessCode = localStorage.getItem("accessCode") || "";

async function login(){
  accessCode = document.getElementById("codeInput").value;
  localStorage.setItem("accessCode", accessCode);
  loadData();
}

function showApp(){
  document.getElementById("loginBox").style.display = "none";
  document.getElementById("app").style.display = "block";
}

async function loadData(){
  const res = await fetch("/api/data", {
    headers: { "access-code": accessCode }
  });

  if (!res.ok) {
    alert("Błędny kod dostępu");
    return;
  }

  const data = await res.json();
  showApp();

  // LICZNIKI
  document.getElementById("cLysy").innerText  = data.lysy;
  document.getElementById("cPawel").innerText = data.pawel;

  // HISTORIA
  let html = "";
  for (const h of data.history) {
    html += `
      <div class="record">
        <b>${h.person}</b> | ${h.date}<br>
        ${h.text || ""}
        ${h.img ? `<br><img src="${h.img}">` : ""}
      </div>
    `;
  }

  document.getElementById("history").innerHTML = html;
}

async function send(){
  const fd = new FormData();
  fd.append("person", document.getElementById("person").value);
  fd.append("text", document.getElementById("text").value);

  const imgInput = document.getElementById("img");
  if (imgInput.files[0]) fd.append("image", imgInput.files[0]);

  await fetch("/api/add", {
    method: "POST",
    headers: { "access-code": accessCode },
    body: fd
  });

  document.getElementById("text").value = "";
  document.getElementById("img").value = "";

  loadData();
}

// AUTO-LOGIN
if (accessCode) loadData();
</script>
